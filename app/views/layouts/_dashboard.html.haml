- content_for :additional_head do
  %link{ href: "https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.min.css", rel: "stylesheet" }
  %script{ src: "https://cdnjs.cloudflare.com/ajax/libs/tabulator/6.2.5/js/tabulator.min.js" }
  %script{ src: "https://cdnjs.cloudflare.com/ajax/libs/luxon/3.4.4/luxon.min.js" }
  %script{ src: "https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js", defer: true }
  %link{rel: "stylesheet", href: "https://cdnjs.cloudflare.com/ajax/libs/tabulator/6.2.5/css/tabulator_semanticui.min.css", integrity: "sha512-V5osaNojM1vXQvKtRIjCawiV39/632N1HTlfUnlBu35bY7CTbUbeubWOiQcWPuWxGrj+DDXh/Kl1qAILGA/8Og==", crossorigin: "anonymous", referrerpolicy: "no-referrer"}

.text-gray-800
  - # start side navigation
  %aside{ class: "fixed left-0 top-0 w-64 h-full bg-gradient-to-b from-[#f8f4f3] to-red-50 p-4 z-40 sidebar-menu transition-transform md:translate-x-0 -translate-x-full shadow-xl" }
    %a{ 
      href: index_dashboard_path,
      class: "flex items-center pb-4 border-b-2 border-red-300 mb-2"
    }
      .bg-gradient-to-r.from-red-500.to-red-600.p-2.rounded-lg.mr-3
        %i.ri-shield-check-line.text-white.text-2xl
      %h2.font-bold.text-2xl.uppercase.bg-gradient-to-r.from-red-600.to-red-800.bg-clip-text.text-transparent
        TKJ PERIODIK

    %ul.mt-4
      - menu_items = [ { link: root_path, 
      icon: "ri-home-2-line", caption: "Beranda" },
        { icon: "ri-a-b", caption: "Ujian",
        submenu: [ { link: index_module_exam_path, caption: "Lihat" }, 
        { link: index_module_history_path, caption: "Riwayat" } ] } ]

      - admin_menu_items = [ { icon: "ri-group-line", 
      caption: "Kelola Pengguna", submenu: [ { link: index_manage_user_active_path,
      caption: "Pengguna Aktif" },
        { link: index_manage_user_verification_path, caption: "Belum Terverifikasi" }, 
        { link: index_manage_user_forgot_path, caption: "Lupa Kata Sandi" }, 
        { link: index_manage_user_nonactive_path, caption: "Pengguna Nonaktif" }, ] }, 
        { icon: "ri-calendar-check-fill", caption: "Kelola Ujian", submenu: [ { link: new_manage_exam_active_path, caption: "Buat Ujian" },
        { link: index_manage_exam_active_path, caption: "Semua Ujian" }, ] }, 
        { icon: "ri-medal-line", caption: "Kelola Nilai", submenu: [ { link: index_manage_score_by_nrp_path, caption: "Berdasarkan ID" },
        { link: index_manage_score_path, caption: "Dengan Kode Fomulir"}, ] },
        ]
      
      - superadmin_menu_items = [ { icon: "ri-admin-line", 
      caption: "Kelola Operator", submenu: [ { link: new_superadmin_promote_path,
      caption: "Tambah Operator" },
        { link: index_superadmin_promote_path, caption: "Semua Operator" }, 
        ] },
        { icon: "ri-tools-fill", 
      caption: "Fitur Lainnya", submenu: [ { link: new_superadmin_user_path,
      caption: "Tambah Pengguna" },
        { link: new_superadmin_participant_path, caption: "Tambah Peserta Ujian" }, 
        { link: search_superadmin_forms_path, caption: "Cetak Formulir Ujian" }, 
        ] } ]

      // 2025 Update
      - polda_menu_items = [ { icon: "ri-file-copy-2-line", caption: "Kelola Laporan", link: new_superadmin_promote_path },
        { icon: "ri-user-line", caption: "Kelola Profil PJ", link: new_superadmin_promote_path } ]

      - account_menu_items = [ { link: edit_module_profile_path, 
        icon: "ri-user-settings-line", caption: "Pengaturan Profil" } ]
   
      - menu_items.each do |item|
        = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }
      
      - if @admin
        .divider.text-gray-600.font-bold.uppercase.text-xs.mt-4.flex.items-center.gap-2
          .bg-red-500.w-1.h-4.rounded-full
          %span Menu Admin
        - admin_menu_items.each do |item|
          = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }
      
      - if @super_admin
        .divider.text-gray-600.font-bold.uppercase.text-xs.mt-4.flex.items-center.gap-2
          .bg-blue-500.w-1.h-4.rounded-full
          %span Menu Superadmin
        - superadmin_menu_items.each do |item|
          = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }
      
      - if @polda_staff
        - if current_user.polda_staff.name != nil
          .divider.text-gray-600.font-bold.uppercase.text-xs.mt-4.flex.items-center.gap-2
            .bg-green-500.w-1.h-4.rounded-full
            %span Menu Polda
          - polda_menu_items.each do |item|
            = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }

      .divider.text-gray-600.font-bold.uppercase.text-xs.mt-4.flex.items-center.gap-2
        .bg-gray-500.w-1.h-4.rounded-full
        %span Akun Saya
      - account_menu_items.each do |item|
        = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }
        %li
          %a{
            href: destroy_user_session_path,
            class:"flex font-semibold items-center py-2 px-4 text-gray-900 hover:bg-gray-950 hover:text-gray-100 rounded-md group-[.active]:bg-gray-800 group-[.active]:text-white group-[.selected]:bg-gray-950 group-[.selected]:text-gray-100",
            data: { turbo_method: :delete } }
            %i{ class: "ri-logout-circle-line mr-3 text-lg" }
            %span.text-sm Keluar

  %aside{ class: "fixed top-0 left-0 w-full h-full bg-black/50 z-20 md:hidden hidden sidebar-overlay" }
  - # end side navigation

  %section{ class: "w-full md:w-[calc(100%-256px)] md:ml-64 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen transition-all main" }
    - # navigation bar
    %navbar{ class: "py-3 px-4 md:px-6 bg-gradient-to-r from-white to-red-50 flex items-center shadow-lg sticky top-0 left-0 z-30 border-b border-red-100" }
      %button{class: "text-lg text-gray-900 font-semibold sidebar-toggle border-2 border-red-500 hover:bg-red-500 hover:text-white rounded-xl w-10 h-10 p-1 transition-all duration-300 flex items-center justify-center md:rounded-full"}
        %i.ri-menu-line
      
      %ul.ml-auto.flex.items-center.gap-2.md:gap-4
        %button#fullscreen-button.hidden.md:block.p-2.hover:bg-gray-100.rounded-lg.transition-colors
          %svg{ xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", style: "fill: #6b7280; transform: ; msFilter:;" }
            %path{ d:"M5 5h5V3H3v7h2zm5 14H5v-5H3v7h7zm11-5h-2v5h-5v2h7zm-2-4h2V3h-7v2h5z" }
        %li.dropdown
          .dropdown-toggle.flex.items-center.gap-2.md:gap-3.cursor-pointer.hover:bg-gray-50.rounded-xl.p-1.md:p-2.transition-all
            .flex-shrink-0.w-8.h-8.md:w-10.md:h-10.relative
              .p-1.bg-gradient-to-br.from-red-500.to-red-600.rounded-full.focus:outline-none.focus:ring-2.focus:ring-red-400.shadow-md
                %p{ class: "w-6 h-6 md:w-8 md:h-8 rounded-full text-white text-sm md:text-lg text-center font-black flex items-center justify-center" }= current_user.user_detail.name[0]
                .top-0.left-5.md:left-7.absolute.w-2.h-2.md:w-3.md:h-3.bg-lime-400.border-2.border-white.rounded-full.animate-ping
                .top-0.left-5.md:left-7.absolute.w-2.h-2.md:w-3.md:h-3.bg-lime-400.border-2.border-white.rounded-full
            .hidden.md:block.text-left
              %h2.text-xs.md:text-sm.font-semibold.text-gray-800.leading-tight= current_user.user_detail.name 
              %p.text-xs.text-gray-500= current_user.identity
    - # Content
    .pt-4.p-4.md:p-8
      #greeting{ class: "mb-4" }
        .bg-white.rounded-xl.shadow-sm.p-3.md:p-4.border.border-gray-100
          %p#greeting-text.text-xs.md:text-sm.text-gray-700
      = yield :content
  
:javascript
  if (typeof serverTime === 'undefined') {
    let serverTime;
  }

  if (typeof clientOffset === 'undefined') {
    let clientOffset;
  }

  function greetingTime() {
    function getGreetingEmoji() {
      const hour = new Date().getHours();
      if (hour >= 5 && hour < 12) {
        return 'Pagi ðŸŒ…'; // Pagi
      } else if (hour >= 12 && hour < 15) {
        return 'Siang ðŸŒž'; // Siang
      } else if (hour >= 15 && hour < 18) {
        return 'Sore ðŸŒ†'; // Sore
      } else {
        return 'Malam ðŸŒ™'; // Malam
      }
    }

    function updateGreeting() {
      const greetingTextElement = document.getElementById('greeting-text');
      if (!greetingTextElement) {
        // Stop interval if element does not exist
        clearInterval(greetingInterval);
        return;
      }

      const now = new Date();
      const adjustedTime = new Date(now.getTime() + clientOffset);

      const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
      const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

      const dayName = days[adjustedTime.getDay()];
      const day = adjustedTime.getDate().toString().padStart(2, '0');
      const month = months[adjustedTime.getMonth()];
      const year = adjustedTime.getFullYear();
      const hours = adjustedTime.getHours().toString().padStart(2, '0');
      const minutes = adjustedTime.getMinutes().toString().padStart(2, '0');
      const seconds = adjustedTime.getSeconds().toString().padStart(2, '0');

      const formattedDate = `${dayName}, ${day} ${month} ${year}`;
      const timeString = `${formattedDate} ${hours}:${minutes}:${seconds}`;
      const emoji = getGreetingEmoji();
      const name = "#{current_user.user_detail.name.split(' ').first}";

      greetingTextElement.innerHTML = `Selamat ${emoji}, <span class="font-semibold text-red-400">${name}</span><br>Waktu server: <span class="text-gray-500">${timeString}</span> WIB`;
    }

    // Fetch server time once
    fetch('/server-time')
      .then(response => response.json())
      .then(data => {
        serverTime = new Date(data.server_time);
        clientOffset = serverTime - new Date(); // Calculate client offset
        updateGreeting();
        // Update every second
        setInterval(updateGreeting, 1000);
      })
      .catch(error => console.error('Error fetching server time:', error));
  }

  document.addEventListener("turbo:load", greetingTime);

  // for POLDA MENU
  //{ icon: "ri-police-badge-line", caption: "Kelola Polda", link: index_manage_polda_region_path },  