- content_for :additional_head do
  %link{ href: "https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.min.css", rel: "stylesheet" }
  %script{ src: "https://cdnjs.cloudflare.com/ajax/libs/tabulator/6.2.5/js/tabulator.min.js" }
  %script{ src: "https://cdnjs.cloudflare.com/ajax/libs/luxon/3.4.4/luxon.min.js" }
  %script{ src: "https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js", defer: true }
  %link{rel: "stylesheet", href: "https://cdnjs.cloudflare.com/ajax/libs/tabulator/6.2.5/css/tabulator_semanticui.min.css", integrity: "sha512-V5osaNojM1vXQvKtRIjCawiV39/632N1HTlfUnlBu35bY7CTbUbeubWOiQcWPuWxGrj+DDXh/Kl1qAILGA/8Og==", crossorigin: "anonymous", referrerpolicy: "no-referrer"}

.text-gray-800
  - # start side navigation
  %aside{ class: "fixed left-0 top-0 w-64 h-full bg-[#f8f4f3] p-4 z-40 sidebar-menu transition-transform md:translate-x-0 -translate-x-full" }
    %a{ 
      href: index_dashboard_path,
      class: "flex items-center pb-4 border-b border-b-gray-800"
    }
      %h2.font-bold.text-2xl.uppercase
        TKJPERIODIK

    %ul.mt-4
      - menu_items = [ { link: root_path, 
      icon: "ri-home-2-line", caption: "Beranda" },
        { icon: "ri-a-b", caption: "Ujian",
        submenu: [ { link: index_module_exam_path, caption: "Lihat" }, 
        { link: index_module_history_path, caption: "Riwayat" } ] } ]

      - admin_menu_items = [ { icon: "ri-group-line", 
      caption: "Kelola Pengguna", submenu: [ { link: index_manage_user_active_path,
      caption: "Pengguna Aktif" },
        { link: index_manage_user_verification_path, caption: "Belum Terverifikasi" }, 
        { link: index_manage_user_forgot_path, caption: "Lupa Kata Sandi" }, 
        { link: index_manage_user_nonactive_path, caption: "Pengguna Nonaktif" }, ] }, 
        { icon: "ri-calendar-check-fill", caption: "Kelola Ujian", submenu: [ { link: new_manage_exam_active_path, caption: "Buat Ujian" },
        { link: index_manage_exam_active_path, caption: "Semua Ujian" }, ] }, 
        { icon: "ri-medal-line", caption: "Kelola Nilai", submenu: [ { link: index_manage_score_path, caption: "Dengan Kode Fomulir"},
        { link: index_manage_score_by_nrp_path, caption: "Berdasarkan NRP" }, ] },
        { icon: "ri-mail-line", caption: "Kelola Surat", submenu: [ { link: index_manage_result_template_path, caption: "Template Surat"},
        { link: index_manage_result_generate_by_nrp_path, caption: "Cetak Berdasarkan NRP" }, ] }, 
        ]
      
      - superadmin_menu_items = [ { icon: "ri-admin-line", 
      caption: "Kelola Operator", submenu: [ { link: new_superadmin_promote_path,
      caption: "Tambah Operator" },
        { link: index_superadmin_promote_path, caption: "Semua Operator" }, 
        ] },
        { icon: "ri-tools-fill", 
      caption: "Fitur Lainnya", submenu: [ { link: new_superadmin_user_path,
      caption: "Tambah Pengguna" },
        { link: new_superadmin_participant_path, caption: "Tambah Peserta Ujian" }, 
        { link: search_superadmin_forms_path, caption: "Cetak Formulir Ujian" }, 
        ] } ]

      // 2025 Update
      - polda_menu_items = [ { icon: "ri-file-copy-2-line", caption: "Kelola Laporan", link: new_superadmin_promote_path },
        { icon: "ri-user-line", caption: "Kelola Profil PJ", link: new_superadmin_promote_path } ]

      - account_menu_items = [ { link: edit_module_profile_path, 
        icon: "ri-user-settings-line", caption: "Pengaturan Profil" } ]
   
      - menu_items.each do |item|
        = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }
      
      - if @admin
        .divider.text-gray-400.font-bold.uppercase menu admin
        - admin_menu_items.each do |item|
          = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }
      
      - if @super_admin
        .divider.text-gray-400.font-bold.uppercase menu superadmin
        - superadmin_menu_items.each do |item|
          = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }
      
      - if @polda_staff
        - if current_user.polda_staff.name != nil
          .divider.text-gray-400.font-bold.uppercase menu polda
          - polda_menu_items.each do |item|
            = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }

      .divider.text-gray-400.font-bold.uppercase akun saya
      - account_menu_items.each do |item|
        = render partial: "shared/component/dashboard/menu_item", locals: { link: item[:link], icon: item[:icon], caption: item[:caption], submenu: item[:submenu] }
        %li
          %a{
            href: destroy_user_session_path,
            class:"flex font-semibold items-center py-2 px-4 text-gray-900 hover:bg-gray-950 hover:text-gray-100 rounded-md group-[.active]:bg-gray-800 group-[.active]:text-white group-[.selected]:bg-gray-950 group-[.selected]:text-gray-100",
            data: { turbo_method: :delete } }
            %i{ class: "ri-logout-circle-line mr-3 text-lg" }
            %span.text-sm Keluar

  %aside{ class: "fixed top-0 left-0 w-full h-full bg-black/50 z-20 md:hidden hidden sidebar-overlay" }
  - # end side navigation

  %section{ class: "w-full md:w-[calc(100%-256px)] md:ml-64 bg-gray-200 min-h-screen transition-all main" }
    - # navigation bar
    %navbar{ class: "py-2 px-6 bg-[#f8f4f3] flex items-center shadow-md shadow-black/5 sticky top-0 left-0 z-30" }
      %button{class: "text-lg text-gray-900 font-semibold sidebar-toggle border-2 border-red-500 hover:bg-red-500 rounded-full w-10 h-10 p-1 "}
        %i.ri-menu-line
      
      %ul.ml-auto.flex.item-center
        %button#fullscreen-button
          %svg{ xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", class: "hover:bg-gray-100 rounded-full", viewBox: "0 0 24 24", style: "fill: gray; transform: ; msFilter:;" }
            %path{ d:"M5 5h5V3H3v7h2zm5 14H5v-5H3v7h7zm11-5h-2v5h-5v2h7zm-2-4h2V3h-7v2h5z" }
        %li.dropdown.ml-3
          .dropdown-toggle.flex.items-center
            .flex-shrink-0.w-10.h-10.relative
              .p-1.bg-red-500.rounded-full.focus:outline-none.focus:ring
                %p{ class: "w-8 h-8 rounded-full text-white text-lg text-center font-black flex items-center justify-center" }= current_user.user_detail.name[0]
                .top-0.left-7.absolute.w-3.h-3.bg-lime-400.border-2.border-white.rounded-full.animate-ping
                .top-0.left-7.absolute.w-3.h-3.bg-lime-400.border-2.border-white.rounded-full
            .p-2.md:block.text-left
              %h2.text-sm.font-semibold.text-gray-800= current_user.user_detail.name 
              %p.text-xs.text-gray-500= current_user.identity
    - # Content
    .pt-4.p-8
      #greeting{ class: "h-[32px]" }
        %p#greeting-text.text-sm.text-right
      = yield :content
  
:javascript
  if (typeof serverTime === 'undefined') {
    let serverTime;
  }

  if (typeof clientOffset === 'undefined') {
    let clientOffset;
  }

  function greetingTime() {
    function getGreetingEmoji() {
      const hour = new Date().getHours();
      if (hour >= 5 && hour < 12) {
        return 'Pagi ðŸŒ…'; // Pagi
      } else if (hour >= 12 && hour < 15) {
        return 'Siang ðŸŒž'; // Siang
      } else if (hour >= 15 && hour < 18) {
        return 'Sore ðŸŒ†'; // Sore
      } else {
        return 'Malam ðŸŒ™'; // Malam
      }
    }

    function updateGreeting() {
      const greetingTextElement = document.getElementById('greeting-text');
      if (!greetingTextElement) {
        // Stop interval if element does not exist
        clearInterval(greetingInterval);
        return;
      }

      const now = new Date();
      const adjustedTime = new Date(now.getTime() + clientOffset);

      const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
      const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

      const dayName = days[adjustedTime.getDay()];
      const day = adjustedTime.getDate().toString().padStart(2, '0');
      const month = months[adjustedTime.getMonth()];
      const year = adjustedTime.getFullYear();
      const hours = adjustedTime.getHours().toString().padStart(2, '0');
      const minutes = adjustedTime.getMinutes().toString().padStart(2, '0');
      const seconds = adjustedTime.getSeconds().toString().padStart(2, '0');

      const formattedDate = `${dayName}, ${day} ${month} ${year}`;
      const timeString = `${formattedDate} ${hours}:${minutes}:${seconds}`;
      const emoji = getGreetingEmoji();
      const name = "#{current_user.user_detail.name.split(' ').first}";

      greetingTextElement.innerHTML = `Selamat ${emoji}, <span class="font-semibold text-red-400">${name}</span><br>Waktu server: <span class="text-gray-500">${timeString}</span> WIB`;
    }

    // Fetch server time once
    fetch('/server-time')
      .then(response => response.json())
      .then(data => {
        serverTime = new Date(data.server_time);
        clientOffset = serverTime - new Date(); // Calculate client offset
        updateGreeting();
        // Update every second
        setInterval(updateGreeting, 1000);
      })
      .catch(error => console.error('Error fetching server time:', error));
  }

  document.addEventListener("turbo:load", greetingTime);

  // for POLDA MENU
  //{ icon: "ri-police-badge-line", caption: "Kelola Polda", link: index_manage_polda_region_path },  