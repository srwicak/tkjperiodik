<% content_for :title do %>
  Orientasi Akun
<% end %>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<%= form_with model: @user_detail, url: create_onboarding_path, method: :post, html: { class: 'min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 relative overflow-hidden' } do |form| %>
  <section class="min-h-screen relative overflow-hidden">
    <!-- Decorative background elements -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute -top-40 -right-40 w-80 h-80 bg-blue-400 rounded-full opacity-10 blur-3xl"></div>
      <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-indigo-400 rounded-full opacity-10 blur-3xl"></div>
    </div>
    
    <div class="w-full mx-auto max-w-[480px] flex flex-col justify-center py-12 px-4 sm:px-6 lg:px-8 relative">
      <div class="max-w-[480px] mx-auto w-full">
        <!-- Header Section -->
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl shadow-lg mb-4">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
          </div>
          <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Selamat Datang!</h1>
          <p class="text-base text-gray-600 mb-1">Aplikasi TKJ Periodik Polri</p>
          <p class="text-sm text-gray-500 max-w-md mx-auto">Mohon lengkapi informasi Anda untuk melanjutkan</p>
        </div>

        <!-- Form Component -->
        <div class="mt-6">
          <div id="error_messages">
            <%= render "shared/error_messages", errors: @user_detail.errors.full_messages, subject: "" if @user_detail.errors.any? %>
          </div>
          
          <div x-data="multiStepForm(<%= current_user.is_police? %>)" class="relative">
            <!-- Progress Indicator -->
            <div class="mb-8 px-4">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center justify-between w-full">
                  <div class="flex flex-col items-center flex-1">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300"
                         :class="step >= 1 ? 'bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg scale-110' : 'bg-gray-200 text-gray-400'">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                      </svg>
                    </div>
                    <span class="text-xs mt-2 font-medium" :class="step >= 1 ? 'text-blue-600' : 'text-gray-400'">Pribadi</span>
                  </div>
                  <div class="flex-1 h-1 mx-2 rounded-full transition-all duration-300" 
                       :class="step >= 2 ? 'bg-gradient-to-r from-blue-500 to-indigo-600' : 'bg-gray-200'"></div>
                  <div class="flex flex-col items-center flex-1">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300"
                         :class="step >= 2 ? 'bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg scale-110' : 'bg-gray-200 text-gray-400'">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                      </svg>
                    </div>
                    <span class="text-xs mt-2 font-medium" :class="step >= 2 ? 'text-blue-600' : 'text-gray-400'" x-text="isPolice ? 'Anggota' : 'Kepegawaian'"></span>
                  </div>
                  <div class="flex-1 h-1 mx-2 rounded-full transition-all duration-300" 
                       :class="step >= 3 ? 'bg-gradient-to-r from-blue-500 to-indigo-600' : 'bg-gray-200'"></div>
                  <div class="flex flex-col items-center flex-1">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300"
                         :class="step >= 3 ? 'bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg scale-110' : 'bg-gray-200 text-gray-400'">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                    </div>
                    <span class="text-xs mt-2 font-medium" :class="step >= 3 ? 'text-blue-600' : 'text-gray-400'">Konfirmasi</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Form Card -->
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6 sm:p-8">
            <!-- Step 1 -->
            <div x-show="step === 1" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-x-8"
                 x-transition:enter-end="opacity-100 transform translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform translate-x-0"
                 x-transition:leave-end="opacity-0 transform -translate-x-8">
              <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center mr-4 shadow-md">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                  </svg>
                </div>
                <div>
                  <h2 class="text-xl font-bold text-gray-900">Informasi Pribadi</h2>
                  <p class="text-sm text-gray-500">Lengkapi data diri Anda</p>
                </div>
              </div>
              
              <div class="space-y-5">
                <div class="space-y-2">
                  <label class="flex items-center text-sm font-medium text-gray-700">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Nama Lengkap
                  </label>
                  <%= form.text_field :name, "x-model" => "formData.name", "@input": "formData.name = formattedName(formData.name)", class: "block w-full h-12 px-4 py-3 placeholder-gray-400 bg-gray-50 border border-gray-200 rounded-xl appearance-none text-gray-900 focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all text-sm", placeholder: "Nama lengkap dengan gelar" %>
                  <p x-show="errors.name" x-text="errors.name" class="text-red-600 text-xs mt-1 flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                  </p>
                </div>
                
                <div class="space-y-2">
                  <label class="flex items-center text-sm font-medium text-gray-700">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    Email <span class="text-gray-400 italic font-normal">(opsional)</span>
                  </label>
                  <%= email_field_tag "user[email]", "", "x-model" => "formData.email", class: "block w-full h-12 px-4 py-3 placeholder-gray-400 bg-gray-50 border border-gray-200 rounded-xl appearance-none text-gray-900 focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all text-sm", placeholder: "alamat@email.com" %>
                  <p x-show="errors.email" x-text="errors.email" class="text-red-600 text-xs mt-1 flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                  </p>
                </div>
                
                <div class="space-y-2">
                  <label class="flex items-center text-sm font-medium text-gray-700">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    Jenis Kelamin
                  </label>
                  <div class="grid grid-cols-2 gap-3">
                    <label class="relative flex items-center justify-center h-12 cursor-pointer">
                      <%= form.radio_button :gender, 1, "x-model" => "formData.gender", class: 'peer sr-only' %>
                      <div class="w-full h-full flex items-center justify-center border-2 border-gray-200 rounded-xl peer-checked:border-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 transition-all hover:border-gray-300">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span class="text-sm font-medium">PRIA</span>
                      </div>
                    </label>
                    <label class="relative flex items-center justify-center h-12 cursor-pointer">
                      <%= form.radio_button :gender, 0, "x-model" => "formData.gender", class: 'peer sr-only' %>
                      <div class="w-full h-full flex items-center justify-center border-2 border-gray-200 rounded-xl peer-checked:border-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 transition-all hover:border-gray-300">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span class="text-sm font-medium">WANITA</span>
                      </div>
                    </label>
                  </div>
                  <p x-show="errors.gender" x-text="errors.gender" class="text-red-600 text-xs mt-1 flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                  </p>
                </div>

                <div class="space-y-2">
                  <label class="flex items-center text-sm font-medium text-gray-700">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    Tanggal Lahir
                  </label>
                  <div class="space-y-2">
                    <%= form.text_field :date_of_birth, 
                      "x-model" => "formData.date_of_birth", 
                      "@input" => "formatDateInput()",
                      maxlength: "10",
                      placeholder: "DD-MM-YYYY",
                      class: 'block w-full h-12 px-4 py-3 placeholder-gray-400 bg-gray-50 border border-gray-200 rounded-xl appearance-none text-gray-900 focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all text-sm text-center font-medium tracking-wider' 
                    %>
                    <p class="text-xs text-gray-500 flex items-center">
                      <svg class="w-3.5 h-3.5 mr-1.5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                      </svg>
                      Format: <span class="font-semibold ml-1">17-08-1945</span>
                      <span class="mx-2 text-gray-300">â€¢</span>
                      untuk 17 Agustus 1945
                    </p>
                  </div>
                  <p x-show="errors.date_of_birth" x-text="errors.date_of_birth" class="text-red-600 text-xs mt-1 flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                  </p>
                </div>
              </div>
              
              <div class="mt-8">
                <button type="button" class="group relative w-full rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 px-8 py-3.5 text-sm font-semibold text-white hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 shadow-lg hover:shadow-xl" @click="nextStep()">
                  <span class="flex items-center justify-center">
                    Selanjutnya
                    <svg class="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                    </svg>
                  </span>
                </button>
              </div>
            </div>
            <!-- Step 2 -->
            <div x-show="step === 2" style="display: none;"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-x-8"
                 x-transition:enter-end="opacity-100 transform translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform translate-x-0"
                 x-transition:leave-end="opacity-0 transform -translate-x-8">
              <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center mr-4 shadow-md">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                  </svg>
                </div>
                <div>
                  <h2 class="text-xl font-bold text-gray-900" x-text="isPolice ? 'Informasi Anggota' : 'Informasi Kepegawaian'"></h2>
                  <p class="text-sm text-gray-500" x-text="isPolice ? 'Data kepangkatan dan kesatuan' : 'Data kepangkatan PNS'"></p>
                </div>
              </div>
              
              <div class="space-y-5">
                <div class="space-y-2">
                  <label class="flex items-center text-sm font-medium text-gray-700">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                    </svg>
                    Pangkat
                  </label>
                  <%= form.select :rank, 
                    @available_ranks.keys.map { |rank| [rank, rank] }, { include_blank: 'Pilih Pangkat' }, 
                    "x-model" => "formData.rank", 
                    class: 'block w-full h-12 px-4 py-3 placeholder-gray-400 bg-gray-50 border border-gray-200 rounded-xl appearance-none text-gray-900 focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all text-sm' 
                  %>
                  <p x-show="errors.rank" x-text="errors.rank" class="text-red-600 text-xs mt-1 flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                  </p>
                </div>
                
                <div class="space-y-2">
                  <label class="flex items-center text-sm font-medium text-gray-700">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                    Satuan Kerja
                  </label>
                  <%= form.select :unit, UserDetail.units.keys.map { |key| [key, key] },
                  { include_blank: 'Pilih Satuan Kerja' },
                  "x-model" => "formData.unit",
                  class: "block w-full h-12 px-4 py-3 placeholder-gray-400 bg-gray-50 border border-gray-200 rounded-xl appearance-none text-gray-900 focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all text-sm" %>
                  <p x-show="errors.unit" x-text="errors.unit" class="text-red-600 text-xs mt-1 flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                  </p>
                </div>
                
                <div class="space-y-2">
                  <label class="flex items-center text-sm font-medium text-gray-700">
                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Jabatan
                  </label>
                  <%= form.text_field :position, "x-model" => "formData.position", "@input": "formData.position = formattedText(formData.position)", class: "block w-full h-12 px-4 py-3 placeholder-gray-400 bg-gray-50 border border-gray-200 rounded-xl appearance-none text-gray-900 focus:border-blue-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all text-sm", placeholder: "Masukkan jabatan atau tanda \"-\" jika tidak ada" %>
                  <p class="text-xs text-gray-500 flex items-center">
                    <svg class="w-3.5 h-3.5 mr-1.5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                    </svg>
                    Jika tidak memiliki jabatan, silakan isi dengan tanda <span class="font-semibold ml-1">"-"</span>
                  </p>
                  <p x-show="errors.position" x-text="errors.position" class="text-red-600 text-xs mt-1 flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                  </p>
                </div>
              </div>
              
              <div class="mt-8 grid grid-cols-2 gap-3">
                <button type="button" class="rounded-xl bg-gray-100 px-6 py-3.5 text-sm font-semibold text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center" @click="previousStep()">
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path>
                  </svg>
                  Kembali
                </button>
                <button type="button" class="rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-3.5 text-sm font-semibold text-white hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center" @click="nextStep()">
                  Selanjutnya
                  <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                  </svg>
                </button>
              </div>
            </div>
            <!-- Step 3 -->
            <div x-show="step === 3" style="display: none;"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-x-8"
                 x-transition:enter-end="opacity-100 transform translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform translate-x-0"
                 x-transition:leave-end="opacity-0 transform -translate-x-8">
              <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-500 rounded-2xl shadow-lg mb-4">
                  <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
                <h2 class="text-xl font-bold text-gray-900 mb-2">Konfirmasi Data</h2>
                <p class="text-sm text-gray-500">Periksa kembali data Anda sebelum menyimpan</p>
              </div>
              
              <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 space-y-4">
                <template x-if="isPolice">
                  <div class="bg-white rounded-lg p-4 shadow-sm">
                    <div class="flex items-start">
                      <div class="flex-shrink-0">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                      </div>
                      <div class="ml-3 flex-1">
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">NRP</p>
                        <p class="mt-1 text-sm font-semibold text-gray-900"><%= current_user.identity %></p>
                      </div>
                    </div>
                  </div>
                </template>
                <template x-if="!isPolice">
                  <div class="bg-white rounded-lg p-4 shadow-sm">
                    <div class="flex items-start">
                      <div class="flex-shrink-0">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                      </div>
                      <div class="ml-3 flex-1">
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">NIP</p>
                        <p class="mt-1 text-sm font-semibold text-gray-900"><%= current_user.identity %></p>
                      </div>
                    </div>
                  </div>
                </template>
                
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                      </svg>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Nama Lengkap</p>
                      <p class="mt-1 text-sm font-semibold text-gray-900" x-text="formData.name"></p>
                    </div>
                  </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                      </svg>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Email</p>
                      <p class="mt-1 text-sm font-semibold text-gray-900 italic" x-text="formData.email || '-'"></p>
                    </div>
                  </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                      </svg>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Jenis Kelamin</p>
                      <p class="mt-1 text-sm font-semibold text-gray-900" x-text="formData.gender == 1 ? 'PRIA' : 'WANITA'"></p>
                    </div>
                  </div>
                </div>

                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Tanggal Lahir</p>
                      <p class="mt-1 text-sm font-semibold text-gray-900" x-text="formatDate()"></p>
                    </div>
                  </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                      </svg>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Pangkat</p>
                      <p class="mt-1 text-sm font-semibold text-gray-900" x-text="formData.rank"></p>
                    </div>
                  </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                      </svg>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Satuan Kerja</p>
                      <p class="mt-1 text-sm font-semibold text-gray-900" x-text="formData.unit"></p>
                    </div>
                  </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                    </div>
                    <div class="ml-3 flex-1">
                      <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Jabatan</p>
                      <p class="mt-1 text-sm font-semibold text-gray-900" x-text="formData.position"></p>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="mt-8 grid grid-cols-2 gap-3">
                <button type="button" class="rounded-xl bg-gray-100 px-6 py-3.5 text-sm font-semibold text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center" @click="previousStep()">
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path>
                  </svg>
                  Kembali
                </button>
                <button type="submit" class="rounded-xl bg-gradient-to-r from-green-500 to-emerald-600 px-6 py-3.5 text-sm font-semibold text-white hover:from-green-600 hover:to-emerald-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center">
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  Simpan Data
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
<% end %>
<script>
  function multiStepForm(isPolice) {
    return {
      step: 1,
      formData: {
        name: '',
        email: '',
        gender: '',
        position: '',
        rank: '',
        unit: '',
        date_of_birth: ''
      },
      errors: {},
      isPolice: isPolice,
      formatDateInput() {
        // Auto-format input dengan dash
        let value = this.formData.date_of_birth.replace(/\D/g, ''); // Hapus non-digit
        
        if (value.length >= 2) {
          value = value.slice(0, 2) + '-' + value.slice(2);
        }
        if (value.length >= 5) {
          value = value.slice(0, 5) + '-' + value.slice(5, 9);
        }
        
        this.formData.date_of_birth = value;
      },
      nextStep() {
        this.errors = this.validate();
        if (Object.keys(this.errors).length === 0) {
          this.step++;
          // Smooth scroll to top of form
          window.scrollTo({ top: 0, behavior: 'smooth' });
        } else {
          // Scroll to first error
          const firstError = document.querySelector('[x-show="errors.' + Object.keys(this.errors)[0] + '"]');
          if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      },
      previousStep() {
        this.step--;
        // Smooth scroll to top of form
        window.scrollTo({ top: 0, behavior: 'smooth' });
      },
      validate() {
        let errors = {};
        if (!this.formData.name) {
          errors.name = 'Nama lengkap diperlukan';
        }
        if (!/^[a-zA-Z., ]+$/.test(this.formData.name)) {
          errors.name = 'Masukan nama yang benar tanpa angka atau simbol';
        }
        if (this.formData.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.formData.email)) {
          errors.email = 'Masukan alamat email yang benar';
        }
        if (!this.formData.gender && this.formData.gender !== 0) {
          errors.gender = 'Jenis kelamin diperlukan';
        }
        
        // Validasi tanggal lahir
        if (!this.formData.date_of_birth) {
          errors.date_of_birth = 'Tanggal lahir diperlukan';
        } else {
          // Cek format DD-MM-YYYY
          const dateRegex = /^(\d{2})-(\d{2})-(\d{4})$/;
          const match = this.formData.date_of_birth.match(dateRegex);
          
          if (!match) {
            errors.date_of_birth = 'Format harus DD-MM-YYYY (contoh: 17-08-1945)';
          } else {
            const day = parseInt(match[1]);
            const month = parseInt(match[2]);
            const year = parseInt(match[3]);
            
            // Validasi range
            if (day < 1 || day > 31) {
              errors.date_of_birth = 'Tanggal harus antara 01-31';
            } else if (month < 1 || month > 12) {
              errors.date_of_birth = 'Bulan harus antara 01-12';
            } else if (year < 1900 || year > new Date().getFullYear()) {
              errors.date_of_birth = 'Tahun tidak valid';
            } else {
              // Validasi tanggal valid untuk bulan tersebut
              const daysInMonth = new Date(year, month, 0).getDate();
              if (day > daysInMonth) {
                errors.date_of_birth = `Tanggal ${day} tidak valid untuk bulan ${month}`;
              } else {
                // Validasi umur (harus antara 18-70 tahun)
                const birthDate = new Date(year, month - 1, day);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                  age--;
                }
                
                if (age < 18) {
                  errors.date_of_birth = 'Usia minimal 18 tahun';
                } else if (age > 70) {
                  errors.date_of_birth = 'Usia maksimal 70 tahun';
                }
              }
            }
          }
        }
        
        if (this.step === 2) {
          if (!this.formData.rank) {
            errors.rank = 'Pangkat diperlukan';
          }
          if (!this.formData.unit) {
            errors.unit = 'Satuan kerja diperlukan';
          }
          if (!this.formData.position) {
            errors.position = 'Jabatan diperlukan';
          }
        }
        return errors;
      },
      formatDate() {
        if (!this.formData.date_of_birth) return '-';
        
        const dateRegex = /^(\d{2})-(\d{2})-(\d{4})$/;
        const match = this.formData.date_of_birth.match(dateRegex);
        
        if (match) {
          const day = match[1];
          const month = match[2];
          const year = match[3];
          const months = ['', 'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
          return `${parseInt(day)} ${months[parseInt(month)]} ${year}`;
        }
        return this.formData.date_of_birth;
      },
      formattedName(name) {
        let parts = name.split(',');

        if (parts.length > 1) {
          parts[0] = parts[0].toUpperCase();
        } else {
          parts[0] = parts[0].toUpperCase();
        }

        return parts.join(',');
      },
      formattedText(text) {
        return text.toUpperCase();
      }
    };
  }
</script>
