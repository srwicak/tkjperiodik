- content_for :title do
  Ubah Daerah - Dasbor

- content_for :content do
  .mobile-message
    .mt-8.bg-yellow-100.border-l-4.border-yellow-500.text-yellow-700.p-4
      %p.font-bold Maaf, laman ini tidak bisa diakses dengan ponsel.
  .desktop-content
    .text-3xl.font-black.my-8
      %a{ class:"p-1 bg-gray-400 rounded-full hover:bg-gray-600 hover:text-white text-3xl", href: index_manage_polda_region_path } 
        %i.ri-arrow-left-line
      %span.ml-2.mb-6 Ubah daerah
    .p-6.bg-white.rounded-xl
      .text-lg.font-bold.mb-4 Ubah daerah polisi adalah proses memperbarui informasi tentang wilayah yang dikelola oleh Polda. Pastikan nama daerah tetap unik dan sesuai dengan pola yang telah ditetapkan.
      .text-sm.text-gray-500.mb-4 Silakan isi form berikut untuk mengubah daerah yang sudah ada. Pastikan nama daerah tetap unik dan tidak ada duplikasi. Pola nama daerah adalah "Polda [Nama Daerah]".

      = render 'form'

      .divider.divider-start.uppercase.text-gray-400.font-bold.mt-8 hapus daerah

      .text-gray-600.mb-4
        %i.ri-error-warning-fill
        %span.italic.text.sm Ketika daerah dihapus, semua data terkait yang ada di dalamnya akan ikut terhapus. Pastikan tidak ada data penting yang tersimpan di daerah ini.
      / Tombol hapus
      %button.btn.btn-error{ onclick: "document.getElementById('delete_modal').showModal()" }
        %i.ri-delete-bin-2-line
        Hapus Daerah

      / Modal konfirmasi hapus
      %dialog#delete_modal.modal
        .modal-box
          %h3.text-lg.font-bold.uppercase.mb-4 Hapus Daerah
          .mb-4 
            %p Apakah Anda yakin ingin menghapus daerah ini?
            %p 
              Nama daerah: 
              %span.font-semibold= @region.name
          %form.flex.gap-x-2{ method:"dialog" }
            %button#delete_button.btn.btn-error Konfirmasi
            %button.btn.grow Batal

= render "layouts/dashboard"

:javascript
  document.getElementById("delete_button").addEventListener("click", () => {
    // Hapus '/ubah' di akhir path
    const path = window.location.pathname.replace(/\/ubah$/, "");

    fetch(path, {
      method: 'DELETE',
      headers: {
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
        'Content-Type': 'application/json'
      }
    }).then(response => response.json())
      .then(data => {
        if (data.success) {
          window.location.replace(data.redirect_path);
        } else {
          window.location.replace(data.redirect_path);
          console.error("Error delete region:", data.error);
        }
      }).catch(error => console.error("Error:", error))
  })
