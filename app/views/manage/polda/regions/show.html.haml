- content_for :title do
  Informasi Daerah Polisi - Dasbor

- content_for :content do
  .mobile-message
    .mt-8.bg-yellow-100.border-l-4.border-yellow-500.text-yellow-700.p-4
      %p.font-bold Maaf, laman ini tidak bisa diakses dengan ponsel.
  .desktop-content
    .text-3xl.font-black.my-8
      %a{ class:"p-1 bg-gray-400 rounded-full hover:bg-gray-600 hover:text-white text-3xl", href: index_manage_polda_region_path }
        %i.ri-arrow-left-line
      %span.ml-2.mb-6 Informasi Daerah Polisi
      %span= @region.name
    .p-6.bg-white.rounded-xl.max-w-2xl.w-full
      .text-lg.font-bold.mb-4 Informasi Daerah Polisi
      .text-sm.text-gray-500.mb-4
        Berikut adalah informasi detail mengenai daerah polisi yang dikelola oleh Polda. Data ini digunakan untuk mengelompokkan wilayah administratif kepolisian.

      - if @region.polda_staffs.any?
        - @staff = @region.polda_staffs.first

        / Input nomor HP dan tombol kirim WA
        .flex.items-center.gap-2.mb-6
          %input#wa_number_reset.input.input-bordered.input-sm{type: "text", placeholder: "08xxxxxxxxxx", style: "max-width: 180px;"}
          %button.btn.btn-warning.btn-sm{type: "button", onclick: "sendWAReset()"} Kirim Link Reset Password ke WhatsApp
        %table.table-fixed.w-full.border.rounded-lg.shadow-sm.bg-gray-50
          %tbody
            %tr
              %td.font-semibold.px-4.py-2{class: "w-1/3"} Username
              %td.px-4.py-2= @staff.user.identity
            %tr
              %td.font-semibold.px-4.py-2{class: "w-1/3"} Nama PJ Polda
              %td.px-4.py-2= @staff.name || "Belum pernah login"
            %tr
              %td.font-semibold.px-4.py-2 Identitas (NRP/NIP)
              %td.px-4.py-2= @staff.identity || "Belum pernah login"
            %tr
              %td.font-semibold.px-4.py-2 No Hp
              %td.px-4.py-2= @staff.phone || "Belum pernah login"
            %tr
              %td.font-semibold.px-4.py-2 Terakhir Login
              %td.px-4.py-2= @staff.user.last_sign_in_at ? I18n.l(@staff.user.last_sign_in_at, format: :full_wib) : "Belum pernah login"
        

      - else
        = button_to "Buat Staff Polda", create_manage_polda_staff_path(@region.slug), method: :post, class: "btn btn-primary mt-4"
        .text-xs.text-gray-500.mt-2 Belum ada staff untuk daerah ini. Klik tombol di atas untuk membuat staff polda.

= render "layouts/dashboard"

:javascript
  function sendWAReset() {
    var number = document.getElementById("wa_number_reset").value;
    var polda = "#{@region.name}";
    var username = "#{@staff&.user&.identity || ''}";
    var reset_url = "#{@staff ? new_user_password_reset_url(identity: @staff.identity) : ''}";
    var message = encodeURIComponent(
      "Permintaan reset password akun staff " + polda + ":\nUsername: " + username +
      "\nSilakan klik link berikut untuk mengatur ulang password Anda:\n" + reset_url +
      "\n\nPetunjuk:" +
      "\n1. Klik link di atas untuk membuka halaman reset password." +
      "\n2. Masukkan username ke NRP/NIP." +
      "\n3. Kosongkan email." +
      "\n4. Masukkan password baru dua kali." +
      "\n5. Klik tombol 'Atur Ulang Password'." +
      "\n6. Hubungi nomor ini kembali jika sudah melakukan reset password." +
      "\n\n*Jika Anda mengalami kesulitan, silakan hubungi admin Polda.*" +
      "\n_Jika Anda tidak mengenali permintaan ini, abaikan pesan ini._"
    );
    var wa_link = "https://wa.me/" + number.replace(/^0/, "62") + "?text=" + message;
    window.open(wa_link, "_blank");
  }
