- content_for :title do
  Ubah Nilai - Dasbor

- content_for :content do
  .mobile-message
    .mt-8.bg-yellow-100.border-l-4.border-yellow-500.text-yellow-700.p-4
      %p.font-bold Maaf, laman ini tidak bisa diakses dengan ponsel.
  .desktop-content
    .divider.divider-start.uppercase.text-gray-400.font-bold.mt-8 informasi kepesertaan

    .max-w-4xl.w-full
      = render "exam_user_info", show_correction_button: true

    .divider.divider-start.uppercase.text-gray-400.font-bold.mt-8 informasi penilai

    .max-w-4xl.w-full
      %table.w-full.text-left.border.border-separate.rounded.border-slate-200{ cellspacing: "0" }
        %tbody
          %tr
            %th.h-12.px-6.text-sm.stroke-slate-700.text-slate-700.bg-slate-100.rounded-t.font-bold{ scope: "col", colspan: "2" } Informasi Penilai

          %tr.transition-colors.duration-300.hover:bg-slate-50
            %td.h-12.px-6.text-sm.transition.duration-300.border-t.border-l.first:border-l-0.border-slate-200.stroke-slate-500.text-slate-500{ class: "w-[200px]" } NRP Penginput Nilai
            %td.h-12.px-6.text-sm.transition.duration-300.border-t.border-l.first:border-l-0.border-slate-200.stroke-slate-500.text-slate-500
              - if @score.first_input_by.present?
                = link_to @score.first_input_by.identity, show_manage_user_active_path(@score.first_input_by.slug), class: "link link-hover text-blue-600"
              - else
                %span.text-gray-400.italic Belum ada pengisian nilai

          %tr.transition-colors.duration-300.hover:bg-slate-50
            %td.h-12.px-6.text-sm.transition.duration-300.border-t.border-l.first:border-l-0.border-slate-200.stroke-slate-500.text-slate-500{ class: "w-[200px]" } Waktu Pembuatan Nilai
            %td.h-12.px-6.text-sm.transition.duration-300.border-t.border-l.first:border-l-0.border-slate-200.stroke-slate-500.text-slate-500
              - if @score.first_input_at.present?
                = I18n.l(@score.first_input_at, format: :full_wib)
              - else
                %span.text-gray-400.italic Belum ada pengisian nilai

          %tr.transition-colors.duration-300.hover:bg-slate-50
            %td.h-12.px-6.text-sm.transition.duration-300.border-t.border-l.first:border-l-0.border-slate-200.stroke-slate-500.text-slate-500{ class: "w-[200px]" } NRP Pengubah Terakhir
            %td.h-12.px-6.text-sm.transition.duration-300.border-t.border-l.first:border-l-0.border-slate-200.stroke-slate-500.text-slate-500
              - if @score.last_edited_by.present?
                = link_to @score.last_edited_by.identity, show_manage_user_active_path(@score.last_edited_by.slug), class: "link link-hover text-blue-600"
              - else
                %span.text-gray-400.italic Belum ada perubahan nilai

          %tr.transition-colors.duration-300.hover:bg-slate-50
            %td.h-12.px-6.text-sm.transition.duration-300.border-t.border-l.first:border-l-0.border-slate-200.stroke-slate-500.text-slate-500{ class: "w-[200px]" } Waktu Terakhir Pengubahan
            %td.h-12.px-6.text-sm.transition.duration-300.border-t.border-l.first:border-l-0.border-slate-200.stroke-slate-500.text-slate-500
              - if @score.last_edited_at.present?
                = I18n.l(@score.last_edited_at, format: :full_wib)
              - else
                %span.text-gray-400.italic Belum ada perubahan nilai

    .divider.divider-start.uppercase.text-gray-400.font-bold.mt-8 ubah nilai ujian

    .max-w-4xl.w-full
      .text-sm.uppercase.flex.flex-col.items-end.font-bold.text-gray-400.mb-6 
        .flex-row
          %p tip dalam berpindah masukkan:
        .flex-row
          %p 
            Gunakan tombol 
            %kbd.kbd.kbd-sm tab
            untuk maju 
        .flex-row
          %p 
            Gunakan tombol
            %kbd.kbd.kbd-sm shift
            +
            %kbd.kbd.kbd-sm tab
            untuk mundur 
        .flex-row
        .flex-row
          %p.text-red-500 pastikan untuk mengecek juga kesesuaian peserta di atas
        .flex-row
          %p 
            untuk kemudahan perhitungan, angka desimal gunakan 
            %span.text-red-500 titik 
            bukan koma
      = render "form_simple"

  -# Modal for correction
  %dialog#correction_modal.modal
    .modal-box.max-w-2xl
      %h3.text-lg.font-bold.uppercase.mb-4 Koreksi Data Peserta Ujian
      
      .alert.alert-info.mb-4
        %i.ri-information-line
        %span.text-sm
          Gunakan form ini untuk mengoreksi data ujian jika terjadi kesalahan input pada saat pendaftaran (misalnya: kesalahan golongan akibat error JavaScript di perangkat Apple).
      
      = form_with url: edit_manage_score_path(@score.slug), method: :patch, id: "correction-form" do |f|
        = hidden_field_tag 'correction_only', 'true'
        
        .space-y-4
          .form-control
            %label.label
              %span.label-text.font-semibold Tinggi Badan (TB) saat ujian
            = f.number_field :tb, value: @registration.tb, class: "input input-bordered w-full", name: "registration[tb]", placeholder: "Contoh: 170", min: 100, max: 250
            .label
              %span.label-text-alt.text-gray-500 Dalam satuan centimeter (cm)
          
          .form-control
            %label.label
              %span.label-text.font-semibold Berat Badan (BB) saat ujian
            = f.number_field :bb, value: @registration.bb, class: "input input-bordered w-full", name: "registration[bb]", placeholder: "Contoh: 65", min: 30, max: 200
            .label
              %span.label-text-alt.text-gray-500 Dalam satuan kilogram (kg)
          
          - if @age_at_exam.present?
            .form-control
              %label.label
                %span.label-text.font-semibold Golongan Ujian
              %select.select.select-bordered.w-full{ name: "registration[golongan]" }
                %option{ value: "1", selected: @golongan == 1 } Golongan 1 (Di bawah 31 tahun)
                %option{ value: "2", selected: @golongan == 2 } Golongan 2 (31-40 tahun)
                %option{ value: "3", selected: @golongan == 3 } Golongan 3 (41-50 tahun)
                %option{ value: "4", selected: @golongan == 4 } Golongan 4 (51 tahun ke atas)
              .label
                %span.label-text-alt.text-gray-500
                  - age_detail = @registration.age_in_years_and_days_at_exam
                  - if age_detail
                    Umur saat ujian: #{age_detail[:years]} tahun #{age_detail[:months]} bulan #{age_detail[:days]} hari
                  - else
                    Umur saat ujian: #{@age_at_exam} tahun
          
          .alert.alert-warning
            %i.ri-alert-line
            %span.text-sm.font-semibold Perhatian: Perubahan golongan akan mempengaruhi standar penilaian ujian. Pastikan data yang dimasukkan sudah benar.
        
        .modal-action
          %button.btn{ type: "button", onclick: "document.getElementById('correction_modal').close()" } Batal
          %button.btn.btn-warning.text-white{ type: "button", onclick: "submitCorrectionForm()" } 
            %i.ri-save-line
            Simpan Koreksi

:javascript
  function openCorrectionModal() {
    document.getElementById('correction_modal').showModal();
  }
  
  function submitCorrectionForm() {
    if (confirm('Apakah Anda yakin ingin menyimpan koreksi data ini?\n\nPerubahan golongan akan mempengaruhi standar penilaian. Pastikan data sudah benar.')) {
      document.getElementById('correction-form').submit();
    }
  }



        
= render "layouts/dashboard"