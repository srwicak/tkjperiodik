.max-w-xl.mx-auto.text-center.bg-white.px-4.sm:px-8.py-10.rounded-xl.shadow(x-data="codeForm")
  %header.mb-8
    %h1.text-2xl.font-bold.mb-1 Masukkan kode ujian
    %p.text-slate-500 
      Kode ujian berada di bawah kiri formulir penilaian. 
    / Component: Bottom base sized tooltip
    %p.text-sm.text-slate-400.label-text-alt.relative.overflow-hidden.cursor-pointer.group.hover:overflow-visible.focus-visible:outline-none{"aria-describedby" => "tooltip"}
      / Tooltip trigger
      %i.ri-information-line
      Geser tetikus ke sini untuk informasi.
      / End Tooltip trigger
      %span#tooltip.invisible.absolute.top-full.z-10.mt-2.rounded.bg-slate-700.p-4.text-sm.text-white.opacity-0.transition-all.before:invisible.before:absolute.before:bottom-full.before:z-10.before:mt-2.before:-ml-2.before:border-x-8.before:border-b-8.before:border-x-transparent.before:border-b-slate-700.before:opacity-0.before:transition-all.group-hover:visible.group-hover:block.group-hover:opacity-100.group-hover:before:visible.group-hover:before:opacity-100{class: "w-[400px] left-1/2 -translate-x-1/2 before:left-1/2 before:content-['']", role: "tooltip"} 
        = image_tag "kode-ujian.webp", alt: "Kode Ujian"
      / End Bottom base sized tooltip

  %form#code-form{ "@submit.prevent": "checkcode" }
    .flex.items-center.justify-center.gap-3
      - (0..2).each do |i|
        %input.w-16.h-16.text-center.text-2xl.font-extrabold.text-slate-900.bg-slate-100.border.border-transparent.appearance-none.rounded.p-4.outline-none{ 
          class:"focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100 hover:border-slate-200", 
          type:"text", 
          maxlength:"1",
          "@input": "handleInput($event, #{i})",
          "@focus": "handleFocus($event)",
          "@keydown": "handleKeyDown($event, #{i})",
          "x-ref": "input#{i}",
          "x-model": "code[#{i}]",
          "autofocus": (i == 0)  
        }
      %span.text-2xl.font-extrabold.text-slate-900 -
      - (3..6).each do |i|
        %input.w-16.h-16.text-center.text-2xl.font-extrabold.text-slate-900.bg-slate-100.border.border-transparent.appearance-none.rounded.p-4.outline-none{ 
          class:"focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100 hover:border-slate-200", 
          type:"text", 
          maxlength:"1", 
          "@input": "handleInput($event, #{i})",
          "@focus": "handleFocus($event)",
          "@keydown": "handleKeyDown($event, #{i})",
          "x-ref": "input#{i}",
          "x-model": "code[#{i}]" 
        }

    %p.text-sm.text-slate-500.mt-4 Catatan: Kode berupa A-Z dan 1-9 tidak ada angka kosong (0)
    .mx-auto.mt-4{ class: "max-w-[260px]" }
      %button{ type:"button", "@click":"resetcode", class:"w-full inline-flex justify-center whitespace-nowrap rounded-lg bg-red-500 px-3.5 py-2.5 text-sm font-medium text-white shadow-sm shadow-red-950/10 hover:bg-red-600 focus:outline-none focus:ring focus:ring-red-300 focus-visible:outline-none focus-visible:ring focus-visible:ring-red-300 transition-colors duration-150" } Kosongkan Kode
    
  %div.mt-4
    %p.text-sm.text-accent.flex.items-center.justify-center{"x-show":"isLoading"} 
      %span.loading.loading-infinity.loading-lg
      Mencari data...
    .text-sm.text-green-500{"x-show":"dataFound"}
      %table( class="text-left border border-collapse rounded-lg sm:border-separate border-slate-200 bg-white w-full" cellspacing="0" )
        %tbody
          %tr
            %th( scope="col" class="h-12 px-6 text-sm border-l first:border-l-0 stroke-slate-700 text-slate-700 bg-slate-100 rounded-t-xl font-bold" colspan="2" ) Informasi Pendaftaran

          %tr
            %td( class="h-12 px-6 text-sm transition duration-300 border-t border-l first:border-l-0 border-slate-200 stroke-slate-500 text-slate-500" ) Nama Peserta
            %td( class="h-12 px-6 text-sm transition duration-300 border-t border-l first:border-l-0 border-slate-200 stroke-slate-500 text-slate-500" )
              %p.my-2{ "x-text":"scoreData.name" } 

          %tr
            %td( class="h-12 px-6 text-sm transition duration-300 border-t border-l first:border-l-0 border-slate-200 stroke-slate-500 text-slate-500" ) Nama Ujian
            %td( class="h-12 px-6 text-sm transition duration-300 border-t border-l first:border-l-0 border-slate-200 stroke-slate-500 text-slate-500" )
              %p.my-2{ "x-text":"scoreData.exam_name" } 
          
          %tr
            %td( class="h-12 px-6 text-sm transition duration-300 border-t border-l first:border-l-0 border-slate-200 stroke-slate-500 text-slate-500" ) 
              %p.my-2 Status Penilaian
            %td( class="h-12 px-6 text-sm transition duration-300 border-t border-l first:border-l-0 border-slate-200 stroke-slate-500 text-slate-500" )
              %p{ "x-text":"is_scored()" } 
          
          %tr
            %td( class="h-12 px-6 text-sm transition duration-300 border-t border-l first:border-l-0 border-slate-200 stroke-slate-500 text-slate-500" ) Aksi
            %td( class="h-12 px-6 text-sm transition duration-300 border-t border-l first:border-l-0 border-slate-200 stroke-slate-500 text-slate-500" )
              #action-button-container            

    %p.text-sm.text-red-500.font-bold{"x-show":"!dataFound && !isLoading && message"} 
      Data tidak ditemukan!

:javascript
  function codeForm() {
    return {
      code: ['', '', '', '', '', '', ''],
      isLoading: false, 
      dataFound: false,
      message: '',
      scoreData: {},

      handleInput(event, index) {
        this.code[index] = event.target.value.toUpperCase();
        if (this.isComplete()) {
          this.checkcode();
        }
        if (index < 6 && event.target.value !== '') {
          this.$refs['input' + (index + 1)].focus();
        }
      },
      handleKeyDown(event, index) {
        if (
          !/^[A-Za-z0-9]{1}$/.test(event.key)
          && event.key !== 'Backspace'
          && event.key !== 'Delete'
          && event.key !== 'Tab'
          && !event.metaKey
        ) {
          event.preventDefault();
        }

        if ((event.key === 'Delete' || event.key === 'Backspace')) {
          if (index === 6 && this.code[index] === '') {
            this.$refs['input' + (index - 1)].focus();
            this.code[index - 1] = '';
          } else if (index > 0 && this.code[index] === '') {
            this.code[index - 1] = '';
            this.$refs['input' + (index - 1)].focus();
          } else {
            this.code[index] = '';
          }
        }
      },

      handleFocus(event) {
        event.target.select();
      },

      handleBackspace(event, index) {
        if (event.key === 'Backspace' && index > 0 && this.code[index] === '') {
          this.$refs['input' + (index - 1)].focus();
        }
      },

      isComplete() {
        return this.code.join('').replace('-', '').length === 7;
      },

      checkcode() {
        if (this.isComplete()) {
          this.isLoading = true;
          this.dataFound = false;
          this.message = '';

          const codeCode = this.code.join('').toUpperCase().replace('-', '');

          const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

          fetch('/kelola/nilai/cari', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': csrfToken
            },
            body: JSON.stringify({ code: codeCode })
          })
          .then(response => response.json())
          .then(data => {
            
            this.isLoading = false;

            if (data.success) {
              this.dataFound = true;
              this.scoreData = data.score;
              this.addActionButton();
            } else {
              this.dataFound = false;
              this.message = data.message;
            }
          })          
        }
      },

      is_scored() {
        return this.scoreData.is_scored ? "Sudah ada nilai" : "Belum ada nilai";
      },

      addActionButton() {
        const buttonContainer = document.getElementById('action-button-container');
        buttonContainer.innerHTML = '';
        const actionButton = document.createElement('a');
        actionButton.href = `/kelola/nilai/${this.scoreData.slug}`; 
        actionButton.className = 'btn btn-success text-white uppercase my-2';
        actionButton.textContent = 'Detil Nilai';

        buttonContainer.appendChild(actionButton);
      },

      resetcode() {
        this.code = ['', '', '', '', '', '', ''];
        this.isLoading = false;
        this.dataFound = false;
        this.message = '';
        this.$refs.input0.focus();
      }
    }
  }