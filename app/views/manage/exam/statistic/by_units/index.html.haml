- content_for :title do
  Lihat Peserta Per Kesatuan Kerja - Dasbor

- content_for :content do
  .mobile-message
    .mt-8.bg-yellow-100.border-l-4.border-yellow-500.text-yellow-700.p-4
      %p.font-bold Maaf, laman ini tidak bisa diakses dengan ponsel.
  .desktop-content
    .text-3xl.font-black.my-8
      %a{ class:"p-1 bg-gray-400 rounded-full hover:bg-gray-600 hover:text-white text-3xl", href: show_manage_exam_active_path(@exam.slug) } 
        %i.ri-arrow-left-line
      %span.ml-3 Daftar Peserta 
      .text-xl.ml-14
        #{@exam.name} 
        %p.text-lg
          %i.ri-time-line
          Sesi: #{@exam_date} | #{@start_time} - #{@end_time} WIB

    = render "info"

    .divider.divider-start.uppercase.text-gray-400.font-bold daftar peserta
    .text-sm 
      %i.ri-information-line.text-xl
      %span.text-gray-500.italic Dikarenakan data terenkripsi pada tingkat database maka tidak bisa pencarian secara fuzzy/parsial, mohon masukkan keseluruhan nomor NRP/NIP.
    .mt-4 
      %input#filter-value.input{ type: "text", placeholder: "Masukkan NRP/NIP" }
      %button#filter-search.btn.btn-accent Cari
      %button#filter-clear.btn.btn-error Muat ulang
    %p.text-right.text-gray-600.font-bold.uppercase.text-sm.mt-4
      %span Catatan: [
      %i.ri-search-line.text-red-500
      %span melihat pengguna ] | [
      %i.ri-input-method-line.text-red-500
      %span melihat nilai ]
    .mt-8#data

= render "layouts/dashboard"

:javascript
  var table = new Tabulator("#data",{
    minHeight: 300,
    pagination: true,
    paginationMode: "remote",
    filterMode: "remote",
    ajaxURL: "/kelola/ujian/#{params[:slug]}/sesi/#{params[:session]}/data",
    paginationSize: 10,
    paginationSizeSelector: [10, 25, 50],
    layout: "fitDataFill",
    rowHeader: {
      formatter: "rownum",
      headerSort: false,
      hozAlign: "center",
      vertAlign: "middle",
      resizable: false,
      frozen: true
    },
    columns:[
      { title: "NRP/NIP", field: "identity", width: 100, resizable: false, headerSort: false, vertAlign: "middle" },
      { title: "Nama", field: "name", width: 250, headerSort: false, vertAlign:"middle" },
      { title: "Nilai", field: "score_number", width: 60, headerSort: false, vertAlign:"middle" },
      { title: "Waktu Daftar", field: "created_at", width: 150, formatter: "datetime", headerSort: false, vertAlign: "middle", formatterParams: {
        inputFormat: "iso",
        outputFormat: "HH:mm:ss dd/MM/yy",
        invalidPlaceholder: "[invalid date]",
        timezone: "Asia/Jakarta"
      }},
      { 
        title: "Aksi" ,
        width: 100,
        hozAlign: "center", 
        headerHozAlign: "center", 
        vertAlign: "middle",
        frozen:true,
        headerSort: false,
        formatter: (cell, formatterParams, onRendered) => {
          let link = "";
          if (cell.getRow().getData().user_status != "active") {
            link = "nonaktif/"
          }

          let showButton = document.createElement("a")
          showButton.className =  "btn btn-sm rounded-lg btn-primary uppercase"
          showButton.innerHTML = "<i class=ri-search-line></i>"
          showButton.href = "/kelola/pengguna/" + link + cell.getRow().getData().user_slug

          let editButton = document.createElement("a")
          editButton.className =  "btn btn-sm rounded-lg btn-secondary uppercase"
          editButton.innerHTML = "<i class=ri-input-method-line></i>"
          editButton.href = "/kelola/nilai/" + cell.getRow().getData().score_slug 

          let container = document.createElement("div")
          container.className = "flex space-x-2"
          container.appendChild(showButton)
          container.appendChild(editButton)

          return container          
        }
      }
    ]
  })

  function updateFilter() {
    let search_param = document.getElementById("filter-value").value.trim()

    if(search_param) {
      table.setFilter("identity", "=", search_param)
    }
  }

  document.getElementById("filter-search").addEventListener("click", updateFilter)

  document.getElementById("filter-clear").addEventListener("click", () => { window.location.reload() });